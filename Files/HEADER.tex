\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{datetime2}
\usepackage{url}
\usepackage{amsfonts}
\usepackage{longtable}
\usepackage{extarrows} 
\usepackage{makecell}
\usepackage[ngerman,american]{babel}
\usepackage{placeins}
\usepackage{fancyhdr}
\usepackage{multirow}
\usepackage{tikz}
\usepackage{circuitikz}
\usepackage{physics}
\usepackage{url}
\usepackage{xcolor}
\usepackage[smartEllipses]{markdown}
\usepackage{inconsolata}
\usepackage{listings}
\usepackage{etoolbox}
%\usepackage{mathabx}
\usepackage[linesnumbered, ruled, vlined]{algorithm2e}
\usepackage{setspace}
\usepackage[most,skins]{tcolorbox}
\usepackage{subcaption} 
\usetikzlibrary{positioning,calc}
%\usepackage{draftwatermark}
\usepackage{framed}
%\SetWatermarkText{DRAFT}
%\SetWatermarkScale{5}

\usepackage[left=1in,right=1in,top=1.2in,bottom=1.2in]{geometry}

\newcommand{\tikzmark}[1]{\tikz[overlay,remember picture] \node (#1) [anchor=base] {};}
\newcommand{\snode}[3]{\node [] (#1) at (#2) {$\mathstrut #3$}}
\newcommand{\spath}[2]{\draw[<->] (#1) -- (#2) node [midway, above] () {S}}
\newcommand{\ppath}[2]{\draw[<->] (#1) -- (#2) node [midway, above] () {P}}
 
\fancypagestyle{firstpage}{%
\fancyhf{} % clear all six fields
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
}
\fancypagestyle{firstcoverpage}{%
\fancyhf{} % clear all six fields
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
}
\fancypagestyle{followingpage}{%
\fancyhf{} % clear all six fields
\fancyhead[LE,RO]{\textbf{\thepage}}
\fancyhead[LO,RE]{\nouppercase{\rightmark}}
\renewcommand{\headrulewidth}{0.7pt}
\renewcommand{\footrulewidth}{0pt}
}
\pagestyle{followingpage}
 

%\documentclass[aip,reprint]{revtex4-1}

\newcommand{\ovl}{\overline}
\newcommand{\unl}{\underline}
\newcommand{\sovl}[1]{\overline{#1}} % \smash{#1}\vphantom{a}}}
\newcommand{\sunl}[1]{\underline{#1}} %\smash{#1}\vphantom{a}}}
\newcommand{\oli}{\overline{i}}
\newcommand{\olj}{\overline{j}}
\newcommand{\olk}{\overline{k}}
\newcommand{\oll}{\overline{l}}
\newcommand{\ola}{\overline{a}}
\newcommand{\olb}{\overline{b}}
\newcommand{\olc}{\overline{c}}
\newcommand{\old}{\overline{d}}

\newcommand{\ooli}{\overline{i}}
\newcommand{\oolj}{\overline{j}}
\newcommand{\oolk}{\overline{k}}
\newcommand{\ooll}{\overline{l}}
\newcommand{\oola}{\overline{a}}
\newcommand{\oolb}{\overline{b}}
\newcommand{\oolc}{\overline{c}}
\newcommand{\oold}{\overline{d}}

\newcommand{\ool}[1]{\overline{#1}}

\newcommand{\eps}{\epsilon}

\newcommand{\olI}{\overline{I}}
\newcommand{\olJ}{\overline{J}}
\newcommand{\olK}{\overline{K}}
\newcommand{\olL}{\overline{L}}
\newcommand{\olA}{\overline{A}}
\newcommand{\olB}{\overline{B}}
\newcommand{\olC}{\overline{C}}
\newcommand{\olD}{\overline{D}}

\newcommand{\doti}{\hat{i}}
\newcommand{\dotj}{\hat{j}}
\newcommand{\dotk}{\hat{k}}
\newcommand{\dotl}{\hat{l}}

\newcommand{\dota}{\hat{a}}
\newcommand{\dotb}{\hat{b}}
\newcommand{\dotc}{\hat{c}}
\newcommand{\dotd}{\hat{d}}

\newcommand{\odota}{\overline{\dota}}
\newcommand{\odotb}{\overline{\dotb}}
\newcommand{\udoti}{\underline{\doti}}
\newcommand{\udotj}{\underline{\dotj}}
\newcommand{\udotk}{\underline{\dotk}}
\newcommand{\odotc}{\overline{\dotc}}

\newcommand{\uli}{\underline{i}}
\newcommand{\ulj}{\underline{j}}
\newcommand{\ulk}{\underline{k}}
\newcommand{\ull}{\underline{l}}
\newcommand{\ulm}{\underline{m}}
\newcommand{\uln}{\underline{n}}

\newcommand{\ulgm}{\sunl{\mu}}
\newcommand{\olgm}{\sovl{\mu}}
\newcommand{\ulgn}{\sunl{\nu}}
\newcommand{\olgn}{\sovl{\nu}}
\newcommand{\ulgk}{\sunl{\kappa}}
\newcommand{\ulgt}{\sunl{\tau}}
\newcommand{\ulgl}{\sunl{\lambda}}
\newcommand{\olgl}{\sovl{\lambda}} % use for b
\newcommand{\olga}{\sovl{\alpha}}
\newcommand{\olgb}{\sovl{\beta}}
\newcommand{\ulgs}{\sunl{\sigma}}
\newcommand{\olgs}{\sovl{\sigma}} % use for a
\newcommand{\olgg}{\sovl{\gamma}} 
\newcommand{\olgd}{\sovl{\delta}}

\newcommand{\gm}{\mu}
\newcommand{\gn}{\nu}
\newcommand{\gk}{\kappa}
\newcommand{\gl}{\lambda}
\newcommand{\ga}{\alpha}
\newcommand{\gb}{\beta}
\renewcommand{\gg}{\gamma}
\newcommand{\gd}{\delta}
\newcommand{\gs}{\sigma}

\newcommand{\pa}{^{(\alpha)}}
\newcommand{\pt}{^{(\theta)}}
\newcommand{\pdg}{^{\dagger}}
\newcommand{\ptw}{^{(\theta,\omega)}}

\newcommand{\calJ}{\mathcal{J}}
\newcommand{\calK}{\mathcal{K}}
\newcommand{\calZ}{\mathcal{Z}}

\newcommand{\swtilde}[1]{\widetilde{\smash{#1}}}
\newcommand{\cn}[2]{\left( #1 \mid #2 \right)}
\newcommand{\scn}[2]{\left( \smash{#1} \mid \smash{#2}\right)}
\newcommand{\mbf}[1]{\mathbf{#1}}
\newcommand{\bfun}[2]{\chi_{#1}(\mathbf{r_{#2}})}
\newcommand{\cbra}[1]{\left( #1 \right\rvert }
\newcommand{\scbra}[1]{\left( \smash{#1} \right\rvert }
\newcommand{\cket}[1]{\left\lvert #1 \right)}
\newcommand{\scket}[1]{\left\lvert \smash{#1} \right)}
\newcommand{\sbraket}[2]{\bra{\smash{#1}}\ket{\smash{#2}}}
\newcommand{\sbra}[1]{\bra{\smash{#1}}}
\newcommand{\sket}[1]{\ket{\smash{#1}}}
\newcommand{\B}[2]{B_{#1}^{#2}}
\newcommand{\x}[2]{_{#1}^{#2}}
\newcommand{\xlr}[1]{\xleftrightarrow{#1}}
\newcommand{\wpa}{\left\lvert w\pa \right\rvert}
\newcommand{\tPsi}{\smash{\widetilde{\Psi}}}
\newcommand{\vnorm}[1]{\left\lVert #1 \right\rVert}

\newcommand{\bk}[2]{\bra{#1} \ket{#2}}
\newcommand{\sbk}[2]{\bra{#1} {} \ket{#2}}

\newcommand{\ep}{\epsilon}

\newcommand{\ccpx}[1]{\mathcal{O}(N^{#1})}

\newcommand{\sym}[2]{_{#1 \leftrightarrow #2}}

\newcommand{\ssg}{^{\sigma}}

\newcommand{\mbfx}{\mathbf{x}}

\newcommand{\nonewpage}{\let\cleardoublepage\clearpage
}

\setcellgapes{10pt}

\newtcolorbox{myframe}[2][]{%
  enhanced,colback=white,colframe=black,coltitle=black,
  sharp corners,boxrule=0.4pt,
  fonttitle=\itshape,
  attach boxed title to bottom right={yshift=0.3\baselineskip+0.4pt,xshift=-2mm},
  boxed title style={tile,size=minimal,left=0.5mm,right=0.5mm,
    colback=white,before upper=\strut},
  title=#2,#1
}

\allowdisplaybreaks 

\newcommand{\forcond}{$\alpha=0$ \KwTo $n_{lap}$}
\newcounter{ISTEP}
\newcommand{\itemR}{\item \refstepcounter{ISTEP}}

\def\signed #1{{\leavevmode\unskip\nobreak\hfil\penalty50\hskip2em
  \hbox{}\nobreak\hfil(#1)%
  \parfillskip=0pt \finalhyphendemerits=0 \endgraf}}

\newsavebox\mybox
\newenvironment{aquote}[1]
  {\savebox\mybox{#1}\begin{quote}}
  {\signed{\usebox\mybox}\end{quote}}
  
% needed so that chpater doesn't use plain style
\patchcmd{\chapter}{\thispagestyle{plain}}{\thispagestyle{fancy}}{}{}

\definecolor{light-gray}{gray}{0.95}

\lstnewenvironment{code}
{\lstset{backgroundcolor=\color{light-gray},breaklines=true,basicstyle=\small\ttfamily}}{}

\lstnewenvironment{cppinline}
{\lstset{
	backgroundcolor=\color{light-gray},
	language=C++,
	breaklines=true,
	basicstyle=\small\ttfamily}
}{}

\newtcblisting[auto counter, number within=section]{cpp}[2][]{
	sharp corners, 
    fonttitle=\bfseries, 
    colframe=gray, listing only, 
    	breakable,
    	center,
    	boxrule=0pt,
    	width=1.0\textwidth,
    listing options={
    		frame=none,
    		numbers=left,
    		xleftmargin=1em,
    		breaklines=true,
    		numberstyle=\scriptsize,
    		basicstyle=\small\ttfamily,
    		language=C++
    	}, 
    title=Listing \thetcbcounter: #2, #1}

\newtcblisting[auto counter, number within=section]{fortran}[2][]{
	sharp corners, 
    fonttitle=\bfseries, 
    colframe=gray, listing only, 
    	breakable,
    	center,
    	boxrule=0pt,
    	width=1.0\textwidth,
    listing options={
    		frame=none,
    		numbers=left,
    		xleftmargin=1em,
    		breaklines=true,
    		numberstyle=\scriptsize,
    		basicstyle=\small\ttfamily,
    		language=Fortran
    	}, 
    title=Listing \thetcbcounter: #2, #1}

\lstnewenvironment{flisting}{
	\lstset{
		language=Fortran,
		basicstyle=\ttfamily,
		numbers=left, 
		backgroundcolor=\color{light-gray}
		xleftmargin=1em,
    		breaklines=true,
    		numberstyle=\scriptsize,
}}{}

\newtcbinputlisting[auto counter,number within=section]{cppcode}[3][]{
	sharp corners, 
    fonttitle=\bfseries, 
    colframe=gray, listing only, 
    listing file={#3},
    	breakable,
    	center,
    	boxrule=0pt,
    	width=1.0\textwidth,
    listing options={
    		frame=none,
    		numbers=left,
    		xleftmargin=1em,
    		breaklines=true,
    		numberstyle=\scriptsize,
    		basicstyle=\small\ttfamily,
    		language=C++
    	}, 
    title=Listing \thetcbcounter: #2 (\texttt{\detokenize{#3}}), #1}

\newcommand{\mchem}{{\texttt{MEGALOchem}}}

\selectlanguage{american}

\hyphenation{che-mis-try}
\hyphenation{de-com-po-si-tion}
\hyphenation{com-mu-ni-ca-tion}
\hyphenation{fun-da-men-tal}
\hyphenation{pro-gram-mer}
\hyphenation{pro-gram-mers}
\hyphenation{cuda-Memcpy}
\hyphenation{al-ge-braic}
\hyphenation{dia-gram-ma-tic}
\hyphenation{con-struct-ion}
\hyphenation{de-pen-den-cy}
\hyphenation{ap-proxi-ma-tion}
\hyphenation{ap-proxi-ma-tions}
\hyphenation{de-pen-den-cies}
\hyphenation{factoriza-tion}
\hyphenation{com-plexi-ty}
\hyphenation{com-pressed}
\hyphenation{dis-advan-tage}
\hyphenation{re-com-pu-ted}
\hyphenation{cor-res-pon-ding}
\hyphenation{con-sump-tion}
\hyphenation{sub-pro-gram}
\hyphenation{sub-pro-grams}
\hyphenation{com-pu-ta-tion}
\hyphenation{dis-so-cia-tion}
\hyphenation{con-fi-gu-ra-tion}
\hyphenation{con-fi-gu-ra-tions}
\hyphenation{com-bi-na-tion}
\hyphenation{com-bi-na-tions}
\hyphenation{in-crea-sing}

\selectlanguage{ngerman}

\hyphenation{Pro-gram-bi-blio-thek}
\hyphenation{Clus-ter}
\hyphenation{Me-tho-den}
\hyphenation{e-lek-tro-ni-schen}
\hyphenation{mo-le-ku-la-ren}
\hyphenation{Kom-bi-na-tion}
\hyphenation{Rechnungs-kosten}

\selectlanguage{american}

% rest of document ...

%\newcommand{\nperp}{^{\not\perp}}